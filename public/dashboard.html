<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Principal</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-y: auto;
      }

      body {
        display: flex;
        flex-direction: column;
        font-family: Arial, sans-serif;
      }

      .main-content {
        margin-left: 220px;
        padding: 30px;
        flex-grow: 1;
        overflow-y: auto;
        max-height: 100vh;
      }

      .dashboard {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        text-align: center;
        margin-top: 0;
      }

      .modulos {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .modulo {
        background: #741c62;
        color: white;
        text-align: center;
        padding: 20px;
        border-radius: 8px;
        text-decoration: none;
        transition: background 0.2s;
      }

      .modulo:hover {
        background: #0056b3;
      }

      #bienvenida {
        text-align: center;
        margin-top: 10px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="main-content">
      <div class="dashboard">
        <h2>Panel Principal</h2>
        <p id="bienvenida"></p>
        <div class="modulos" id="modulosContainer"></div>
      </div>
    </div>

    <script type="module">
      import { auth, db } from "./scripts/firebase-config.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
      import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
      import { cargarSidebar } from "./scripts/sidebar.js";

      const modulosContainer = document.getElementById("modulosContainer");
      const bienvenida = document.getElementById("bienvenida");

      const modulosPorRol = {
        admin: [
          { nombre: "Facturación", link: "facturacion.html" },
          { nombre: "Inventario", link: "inventario.html" },
          { nombre: "Ventas", link: "ventas.html" },
          { nombre: "Gastos", link: "gastos.html" },
          { nombre: "Pagos", link: "pagos.html" },
          { nombre: "Caja / Cierre", link: "caja.html" },
          { nombre: "Informes", link: "informes.html" },
          { nombre: "Usuarios", link: "registro.html" },
          { nombre: "Categorías", link: "categorias.html" },
          { nombre: "Detalle Ventas", link: "detalle_ventas.html" },
        ],
        cajero: [
          { nombre: "Facturación", link: "facturacion.html" },
          { nombre: "Ventas", link: "ventas.html" },
          { nombre: "Caja / Cierre", link: "caja.html" },
          { nombre: "Categorías", link: "categorias.html" },
        ],
        mesero: [{ nombre: "Ventas", link: "ventas.html" }],
      };

      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          location.href = "login.html";
          return;
        }

        const docRef = doc(db, "usuarios", user.uid);
        const snap = await getDoc(docRef);
        const data = snap.data();
        const rol = data?.rol || "desconocido";

        cargarSidebar(rol);

        bienvenida.textContent = `Bienvenido, ${data.email} | Rol: ${rol}`;

        const modulos = modulosPorRol[rol] || [];
        modulos.forEach((mod) => {
          const a = document.createElement("a");
          a.className = "modulo";
          a.href = mod.link;
          a.textContent = mod.nombre;
          modulosContainer.appendChild(a);
        });
      });
    </script>
  </body>
</html>
